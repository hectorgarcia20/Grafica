<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>Visualización de Gasto Cardíaco y Flujo Sanguíneo</title>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <style>
    body { font-family: Arial, sans-serif; margin: 20px; }
    h2 { text-align: center; }
    #contenedor { max-width: 900px; margin: auto; }
    input[type="file"] { margin: 20px auto; display: block; }
  </style>
</head>
<body>
  <div id="contenedor">
    <h2>Visualización de Gasto Cardíaco y Flujo Sanguíneo</h2>
    <input type="file" id="fileInput" accept=".txt" />
    
    <div id="grafica-gc" style="height: 400px;"></div>
    <div id="grafica-fs" style="height: 400px;"></div>
  </div>

  <script>
    document.getElementById('fileInput').addEventListener('change', function (e) {
      const file = e.target.files[0];
      if (!file) return;

      const reader = new FileReader();
      reader.onload = function (event) {
        const lines = event.target.result.trim().split('\n');
        const data = [];

        for (let i = 1; i < lines.length; i++) { // saltar cabecera
          const cols = lines[i].split(/\s+/);
          const FC = parseFloat(cols[0]);
          const VS = parseFloat(cols[1]);
          const Diam = parseFloat(cols[6]);
          const Vel = parseFloat(cols[7]);
          if (!isNaN(FC) && !isNaN(VS) && !isNaN(Diam) && !isNaN(Vel)) {
            data.push({ FC, VS, Diam, Vel });
          }
        }

        const tiempo = data.map((_, i) => i); // 1 segundo por muestra
        const GC = data.map(d => (d.FC * d.VS) / 1000);
        const FS = data.map(d => Math.PI * Math.pow(d.Diam / 2, 2) * d.Vel * 60);

        Plotly.newPlot('grafica-gc', [{
          x: tiempo,
          y: GC,
          type: 'scatter',
          mode: 'lines+markers',
          line: { color: 'blue' },
          name: 'GC (L/min)'
        }], {
          title: 'Evolución del Gasto Cardíaco en el Tiempo',
          xaxis: { title: 'Tiempo (s)' },
          yaxis: { title: 'Gasto Cardíaco (L/min)' }
        });

        Plotly.newPlot('grafica-fs', [{
          x: tiempo,
          y: FS,
          type: 'scatter',
          mode: 'lines+markers',
          line: { color: 'red' },
          name: 'FS (L/min)'
        }], {
          title: 'Evolución del Flujo Sanguíneo en el Tiempo',
          xaxis: { title: 'Tiempo (s)' },
          yaxis: { title: 'Flujo Sanguíneo (L/min)' }
        });
      };

      reader.readAsText(file);
    });
  </script>
</body>
</html>
